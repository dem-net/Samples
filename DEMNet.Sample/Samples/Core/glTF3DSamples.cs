//
// glTF3DSamples.cs
//
// Author:
//       Xavier Fischer
//
// Copyright (c) 2019 
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

using DEM.Net.Core;
using DEM.Net.glTF.SharpglTF;
using Microsoft.Extensions.Logging;
using System;
using System.Diagnostics;
using System.IO;
using System.Linq;
using DEM.Net.Core.Imagery;
using SharpGLTF.Schema2;

namespace SampleApp
{
    /// <summary>
    /// Extracts a DEM from a bbox and generates a 3D export in glTF format
    /// </summary>
    public class glTF3DSamples
    {
        private readonly ILogger<glTF3DSamples> _logger;
        private readonly ElevationService _elevationService;
        private readonly ImageryService _imageryService;
        private readonly SharpGltfService _sharpGltfService;

        public glTF3DSamples(ILogger<glTF3DSamples> logger
                , ElevationService elevationService
                , SharpGltfService sharpGltfService
                , ImageryService imageryService)
        {
            _logger = logger;
            _elevationService = elevationService;
            _sharpGltfService = sharpGltfService;
            _imageryService = imageryService;
        }
        public void Run(DEMDataSet dataset, bool withTexture = true)
        {
            try
            {

                int TEXTURE_TILES = 16; // 4: med, 8: high
                float REDUCTION = 1 / 40f;
                float Z_FACTOR = 1.5f;

                //_rasterService.GenerateDirectoryMetadata(dataset, false);
                Stopwatch sw = Stopwatch.StartNew();
                string modelName = $"Dolomites_{dataset.Name}_tex{TEXTURE_TILES}_{1 / REDUCTION}";
                string outputDir = Directory.GetCurrentDirectory();
                ImageryProvider provider = ImageryProvider.MapTilerSatellite;// new TileDebugProvider(new GeoPoint(43.5,5.5));


                //// You can get your boox from https://geojson.net/ (save as WKT)
                //string bboxWKT = "POLYGON((5.54888 43.519525, 5.61209 43.519525, 5.61209 43.565225, 5.54888 43.565225, 5.54888 43.519525))";
                ////                string bboxWKT =
                ////                    "POLYGON((5.594457381483949 43.545276557046044,5.652135604140199 43.545276557046044,5.652135604140199 43.52038635099936,5.594457381483949 43.52038635099936,5.594457381483949 43.545276557046044))";
                ////                _logger.LogInformation($"Processing model {modelName}...");
                ////
                ////
                ////                _logger.LogInformation($"Getting bounding box geometry...");
                //var bbox = GeometryService.GetBoundingBox(bboxWKT);

                // DjebelMarra
                //var bbox = new BoundingBox(24.098067346557492, 24.42468219234563, 12.7769822830208, 13.087504129660111);

                // Dolomites
                var bbox = GeometryService.GetBoundingBox("POLYGON ((12.309158326668324 46.452834489592334, 12.309158326668324 46.19110950009852, 12.784644435942425 46.19110950009852, 12.784644435942425 46.452834489592334, 12.309158326668324 46.452834489592334))");
                //GeometryService.GetBoundingBox("POLYGON((12.377647 46.462563, 12.436746 46.462563, 12.436746 46.434706, 12.377647 46.434706, 12.377647 46.462563))");

                bbox = bbox.ReprojectTo(4326, dataset.SRID);

                // MontBlanc
                //var bbox = GeometryService.GetBoundingBox("POLYGON((6.618804355541963 45.9658287141746,7.052764316479463 45.9658287141746,7.052764316479463 45.72379929776474,6.618804355541963 45.72379929776474,6.618804355541963 45.9658287141746))");

                //var bbox = new BoundingBox(5.5613898348431485,5.597185285307553,43.49372969433046,43.50939068558466);
                _logger.LogInformation($"Getting height map data...");

                var heightMap = _elevationService.GetHeightMap(ref bbox, dataset).BakeCoordinates();
                var mask = "POLYGON ((12.4991537 46.4125171, 12.4967109 46.4124619, 12.4960917 46.4123447, 12.4944229 46.4115075, 12.4895958 46.4086339, 12.4873079 46.406775, 12.487032 46.4064378, 12.4862248 46.404525, 12.4860739 46.4043662, 12.4833372 46.4044874, 12.482723 46.4044451, 12.4816421 46.4041419, 12.4810379 46.4037916, 12.4803283 46.4030186, 12.4787465 46.4007546, 12.4782265 46.3997524, 12.4780478 46.3992042, 12.4774473 46.3982347, 12.4763328 46.397758, 12.4754827 46.3975088, 12.475017 46.3972249, 12.4742024 46.3962969, 12.4733849 46.3950692, 12.4724138 46.3939246, 12.4714949 46.3925506, 12.4702584 46.3912071, 12.4685179 46.3899619, 12.4650483 46.3885804, 12.464466 46.3883918, 12.463809 46.3882879, 12.4616407 46.3891845, 12.4607676 46.3893436, 12.4605939 46.3895903, 12.4602691 46.3897732, 12.4564657 46.3910998, 12.4555207 46.3915511, 12.4552565 46.3915942, 12.4549382 46.3915468, 12.4548912 46.3913038, 12.4556412 46.3895868, 12.4560439 46.3878159, 12.4561384 46.386499, 12.4562914 46.385984, 12.4566986 46.3854602, 12.4582245 46.3841463, 12.4594182 46.3818285, 12.4597746 46.3813238, 12.4605822 46.3805094, 12.4606888 46.3802756, 12.4610148 46.3781805, 12.4609232 46.3764764, 12.4610224 46.3755915, 12.4619016 46.3728722, 12.4620197 46.3727481, 12.4632678 46.3694263, 12.4597915 46.3696544, 12.4573104 46.3700428, 12.4560711 46.3701218, 12.4535513 46.3705351, 12.4513469 46.3706098, 12.4514183 46.3704156, 12.4523307 46.3698542, 12.4529725 46.3692925, 12.4530355 46.3688331, 12.4535517 46.3682887, 12.4548293 46.3675655, 12.4551628 46.3671928, 12.4552969 46.3666341, 12.4550182 46.3660058, 12.455393 46.3651934, 12.4549647 46.3648296, 12.4520702 46.3630199, 12.4497514 46.3613094, 12.4487875 46.3605274, 12.4461691 46.3603583, 12.4445613 46.3602545, 12.4428404 46.360049, 12.4425416 46.3599444, 12.4379423 46.3574222, 12.4359653 46.3561135, 12.4303781 46.3536495, 12.4291892 46.3525716, 12.4285787 46.3517543, 12.4284437 46.3517052, 12.4191388 46.3542834, 12.4176869 46.3547772, 12.4182129 46.3541617, 12.4183235 46.3534903, 12.4191415 46.3521954, 12.4189409 46.3498293, 12.4191843 46.3491666, 12.4199209 46.3482732, 12.4204728 46.3477672, 12.4204388 46.3468996, 12.4205859 46.3461598, 12.4208287 46.3455951, 12.4206743 46.345341, 12.4211351 46.3437674, 12.4211341 46.3434362, 12.4208849 46.3428978, 12.4210023 46.3423474, 12.4204375 46.3420669, 12.4195163 46.3407875, 12.4187061 46.3404179, 12.4185377 46.3399331, 12.4181477 46.3395614, 12.4174735 46.3393964, 12.4164155 46.338376, 12.4162565 46.3376899, 12.4163232 46.3370693, 12.4162059 46.3368218, 12.4154168 46.3362741, 12.4148098 46.3360962, 12.4143174 46.3360447, 12.4141597 46.335949, 12.4141822 46.3346794, 12.413834 46.3338622, 12.4133176 46.3334387, 12.4128733 46.3328987, 12.4121253 46.3316549, 12.4116525 46.3314541, 12.4111207 46.3309179, 12.4108376 46.3307502, 12.4101944 46.3306349, 12.4086038 46.3305095, 12.4006735 46.3293413, 12.3985183 46.3291884, 12.3984721 46.3289599, 12.3980248 46.3289102, 12.3973021 46.3289565, 12.3972183 46.3292984, 12.3967528 46.329691, 12.3956632 46.330091, 12.3928491 46.329818, 12.3917965 46.3299866, 12.3909879 46.3299412, 12.3877259 46.3289793, 12.3869362 46.3289189, 12.3863887 46.3289568, 12.3852704 46.3288142, 12.384623 46.3289326, 12.3841316 46.3289376, 12.3838512 46.3292606, 12.382419 46.3301962, 12.3814031 46.3306841, 12.3802627 46.3309478, 12.3790621 46.3309509, 12.3786766 46.3312409, 12.3782393 46.3312578, 12.3773449 46.3308863, 12.3772878 46.3305592, 12.376742 46.3305071, 12.3759349 46.3301609, 12.3749913 46.3298963, 12.3739446 46.3282036, 12.373762 46.3281094, 12.3734676 46.3276923, 12.3723073 46.326636, 12.3718634 46.3264656, 12.3715984 46.3262471, 12.3700029 46.3256542, 12.3678928 46.3256574, 12.3677292 46.3255076, 12.3674632 46.32568, 12.3663617 46.3258217, 12.3655075 46.3258298, 12.3647144 46.3259647, 12.3639483 46.3240034, 12.3636355 46.3236854, 12.3621183 46.3226555, 12.3613692 46.3225709, 12.3610501 46.322313, 12.3607552 46.3222506, 12.3601413 46.3217215, 12.3589655 46.321597, 12.3580173 46.3211993, 12.3575651 46.3205789, 12.354496 46.3196661, 12.3529746 46.3188005, 12.3542468 46.3174755, 12.3544718 46.3170424, 12.3549158 46.316721, 12.355265 46.3166294, 12.3556541 46.3164041, 12.3558369 46.3156662, 12.3564945 46.3149393, 12.3567384 46.3144625, 12.3567689 46.3142597, 12.3569352 46.3131543, 12.3573308 46.3124468, 12.3572633 46.3119721, 12.3556776 46.3107039, 12.3556506 46.3106406, 12.3560853 46.3104396, 12.3558726 46.310131, 12.3557547 46.3093814, 12.3550878 46.3093335, 12.3543558 46.3088944, 12.3536238 46.308736, 12.3537637 46.3083334, 12.3536128 46.3078545, 12.3534841 46.3077471, 12.3529171 46.3075693, 12.3518772 46.3074803, 12.3520763 46.3071, 12.3524578 46.3056429, 12.3527646 46.3051792, 12.3532896 46.3047021, 12.3536977 46.3041503, 12.3539079 46.3034663, 12.3534942 46.302747, 12.3525501 46.3019227, 12.3525191 46.3017341, 12.352624 46.301711, 12.3527827 46.301332, 12.3526794 46.3004205, 12.3535747 46.2996897, 12.3545606 46.2991606, 12.3547047 46.2989436, 12.3547767 46.2987713, 12.3547006 46.2984077, 12.3540003 46.297872, 12.354241 46.2962773, 12.3546393 46.2961357, 12.3549182 46.2958338, 12.3551216 46.2952215, 12.3560878 46.2943348, 12.3562776 46.2938684, 12.3558694 46.2935899, 12.3552674 46.293446, 12.3547315 46.2935287, 12.3537724 46.2939194, 12.3535066 46.2938807, 12.3532763 46.2937293, 12.352755 46.2935781, 12.35265 46.2938818, 12.3508931 46.2934747, 12.350387 46.2936299, 12.3496148 46.2936862, 12.3487271 46.2932922, 12.3488671 46.2928153, 12.3484029 46.2922433, 12.3483071 46.2921986, 12.3479934 46.2920645, 12.347186 46.2920876, 12.3466111 46.2917959, 12.3455982 46.2917121, 12.3453814 46.2914218, 12.3454095 46.2910467, 12.3449598 46.2910757, 12.3443777 46.2910042, 12.3442807 46.2905195, 12.3441038 46.2904435, 12.3440592 46.2898418, 12.3436895 46.2894621, 12.3437589 46.289204, 12.3441277 46.2889087, 12.3438787 46.2885249, 12.3440886 46.2881958, 12.3438591 46.2880304, 12.343854 46.2879306, 12.3435344 46.2878976, 12.3433242 46.287401, 12.342682 46.2868338, 12.3421557 46.2867292, 12.3419638 46.2863374, 12.341597 46.2861757, 12.3413216 46.2861276, 12.3411745 46.2861961, 12.3409069 46.2861273, 12.3407459 46.2858591, 12.3405217 46.2857929, 12.3403169 46.2857378, 12.3397791 46.285651, 12.3393048 46.285705, 12.3387703 46.2856206, 12.3386441 46.2856687, 12.3386129 46.2860367, 12.3376744 46.2865576, 12.337275 46.286655, 12.3371561 46.2867589, 12.3361028 46.286405, 12.3356689 46.2858228, 12.3354264 46.2856748, 12.3353494 46.2852018, 12.3348024 46.2848678, 12.3339642 46.2846483, 12.3333614 46.2846073, 12.3329528 46.2842265, 12.3324098 46.2839831, 12.3318018 46.2838766, 12.3310023 46.2839464, 12.3305868 46.284106, 12.3303185 46.2839747, 12.3296532 46.2838514, 12.3295449 46.2837374, 12.3296312 46.2835624, 12.3294716 46.2834202, 12.3295518 46.2833124, 12.3295026 46.282669, 12.3296379 46.2821105, 12.3293438 46.2819401, 12.3285954 46.2817015, 12.3283896 46.2813677, 12.3282988 46.2808963, 12.3281123 46.2806382, 12.3281372 46.279755, 12.3240512 46.275485, 12.3243235 46.2749021, 12.3242889 46.2745001, 12.32423 46.274411, 12.3239185 46.2743097, 12.3236103 46.273829, 12.3251413 46.2732659, 12.3259488 46.2731504, 12.3274828 46.2734518, 12.3282608 46.2736907, 12.3296905 46.2745309, 12.3318902 46.2746866, 12.3327093 46.2743972, 12.3343275 46.2731723, 12.3352973 46.2726999, 12.3361311 46.2726284, 12.338118 46.2734121, 12.3391388 46.2736884, 12.3398348 46.2737551, 12.3402451 46.2737041, 12.3405081 46.2733869, 12.340624 46.2733997, 12.3414382 46.2740349, 12.3418976 46.2741769, 12.3423767 46.2742082, 12.3425537 46.2741618, 12.3430015 46.2733389, 12.3434012 46.2730552, 12.3436939 46.2730266, 12.3443859 46.2733256, 12.3453107 46.2734834, 12.345913 46.2733762, 12.3464799 46.27295, 12.3468509 46.2729586, 12.3486972 46.2734913, 12.349366 46.27382, 12.3500124 46.2741582, 12.3511423 46.275048, 12.3516807 46.2753635, 12.3530014 46.2754649, 12.3537663 46.2759169, 12.3548605 46.2761847, 12.3551987 46.2764248, 12.3563384 46.2769563, 12.357084 46.2772059, 12.359813 46.2774104, 12.3609035 46.2771527, 12.3609563 46.2775681, 12.3612164 46.2782206, 12.3615263 46.2784399, 12.3622322 46.2786077, 12.3629181 46.2788862, 12.3633677 46.2792299, 12.363443 46.2794842, 12.3630899 46.2810721, 12.3643474 46.281889, 12.3648515 46.2823147, 12.3652387 46.2827479, 12.3656017 46.2836857, 12.3680281 46.2829133, 12.3685123 46.2825406, 12.3686911 46.2825224, 12.3683796 46.2829425, 12.3683985 46.2836996, 12.3705078 46.2840713, 12.3713283 46.2845852, 12.3725782 46.2849574, 12.373825 46.285087, 12.375014 46.2849022, 12.3756354 46.2847043, 12.3760291 46.2837841, 12.3761841 46.2817572, 12.3760654 46.2815113, 12.3757214 46.2813456, 12.3761948 46.2809689, 12.3764913 46.2795262, 12.3762291 46.2785156, 12.3755741 46.2774961, 12.3748976 46.2759617, 12.3743442 46.275442, 12.3740434 46.2748776, 12.3723114 46.273627, 12.3711012 46.273217, 12.3699838 46.2725817, 12.3692942 46.2724866, 12.3687098 46.2725027, 12.3686815 46.2721441, 12.3676584 46.2714699, 12.3664352 46.2714619, 12.3647269 46.2712407, 12.3637996 46.2705324, 12.3610815 46.2694999, 12.3599272 46.2692712, 12.3585876 46.2692605, 12.3572287 46.2690472, 12.3561083 46.2687183, 12.3553291 46.2681429, 12.3544624 46.2678115, 12.3538813 46.2677778, 12.3534633 46.2679904, 12.3537988 46.268281, 12.3536679 46.268581, 12.3530316 46.2688912, 12.3519638 46.26897, 12.3512035 46.2688617, 12.3498592 46.2684811, 12.3487221 46.2684729, 12.3479815 46.268321, 12.3465878 46.2689619, 12.3444514 46.2695622, 12.3423672 46.2698946, 12.3399744 46.2700689, 12.339781 46.2700333, 12.3379849 46.2690338, 12.3369183 46.2685487, 12.336405 46.2685143, 12.3358692 46.2686705, 12.3356263 46.2689057, 12.3354536 46.2691444, 12.3351365 46.269672, 12.3346774 46.2698579, 12.3339593 46.2699732, 12.3338188 46.2698726, 12.3337669 46.2695298, 12.3335983 46.2693772, 12.3317128 46.2690014, 12.3310541 46.268725, 12.3304598 46.2683383, 12.3297719 46.2680669, 12.328624 46.2678386, 12.3263703 46.2678832, 12.3259183 46.2677053, 12.3255807 46.2673146, 12.325293 46.2672387, 12.3236368 46.2673955, 12.32346 46.2671458, 12.3234384 46.2666956, 12.3228537 46.2661605, 12.3230478 46.2658338, 12.321577 46.2643013, 12.3222045 46.2621786, 12.3229344 46.2605535, 12.3239918 46.2586916, 12.3241431 46.2579994, 12.3241525 46.2572475, 12.3244653 46.2563898, 12.3244799 46.2557194, 12.3251793 46.2549022, 12.3266733 46.2539091, 12.3297854 46.2536434, 12.3321928 46.2535617, 12.3324583 46.2534928, 12.3344958 46.2515345, 12.3355609 46.2491336, 12.3360982 46.2486698, 12.3330904 46.2469762, 12.3333433 46.246418, 12.334008 46.2455685, 12.3341555 46.2451332, 12.3339799 46.2450288, 12.3338702 46.2446815, 12.3345339 46.2442206, 12.3351309 46.2432755, 12.3355262 46.2422004, 12.3356865 46.2420599, 12.3361994 46.2419152, 12.3366166 46.2413232, 12.3367859 46.2411829, 12.3374029 46.2409404, 12.338002 46.2403212, 12.3378213 46.2401353, 12.338395 46.2391082, 12.3383027 46.2387738, 12.3380905 46.238493, 12.3381416 46.2383689, 12.3386119 46.2387309, 12.3400331 46.2394158, 12.3396829 46.2399341, 12.3404877 46.2401033, 12.3415077 46.2401208, 12.3421531 46.2400355, 12.3423904 46.2401935, 12.3425881 46.2402222, 12.3429696 46.2412325, 12.3433905 46.2434381, 12.3436566 46.2436754, 12.3451495 46.2438064, 12.3453352 46.2439841, 12.3452361 46.2448871, 12.3453368 46.2451013, 12.3458406 46.2450167, 12.3459422 46.2452117, 12.345931 46.2460203, 12.3461564 46.2465263, 12.3467989 46.2470229, 12.3475319 46.2473673, 12.348116 46.2479201, 12.348481 46.2484101, 12.3491844 46.2487924, 12.3501726 46.2496051, 12.3506491 46.2505313, 12.3511024 46.251052, 12.3514795 46.2512918, 12.3522173 46.2515401, 12.3528681 46.2518633, 12.3530289 46.2525604, 12.3533783 46.2533775, 12.3539708 46.254335, 12.3541881 46.2550142, 12.3556109 46.2571852, 12.356529 46.2583042, 12.3584124 46.2595613, 12.3601203 46.2610068, 12.3600695 46.2614872, 12.3595075 46.2618154, 12.3585126 46.2619955, 12.3582682 46.2625627, 12.3581425 46.2634458, 12.3587833 46.2639807, 12.3588156 46.2644629, 12.3591384 46.2646823, 12.3596876 46.2648106, 12.3603406 46.2650953, 12.3616582 46.2654146, 12.3627957 46.2654409, 12.3643741 46.2649573, 12.3658212 46.2643164, 12.3663926 46.2639829, 12.3664314 46.2637527, 12.3661835 46.2631306, 12.3641795 46.2613613, 12.3640176 46.2608079, 12.3640723 46.2601108, 12.3643995 46.2590531, 12.3647759 46.2583351, 12.3659428 46.2574623, 12.3664368 46.2575388, 12.3666017 46.2577706, 12.3664465 46.2593186, 12.3667635 46.259785, 12.3672747 46.2601387, 12.367748 46.2603042, 12.3679934 46.2605704, 12.368178 46.2613725, 12.3686594 46.2615424, 12.370699 46.2613926, 12.3729511 46.2615941, 12.3729842 46.2618741, 12.3726261 46.2621761, 12.3716136 46.2625874, 12.3711961 46.2628415, 12.3707781 46.2631594, 12.3706946 46.2633556, 12.3716501 46.2644038, 12.3722155 46.2644636, 12.3723755 46.2646021, 12.3724008 46.2653099, 12.372906 46.2654137, 12.3749974 46.2667377, 12.3754223 46.2670949, 12.3754877 46.2674465, 12.37587 46.2678609, 12.3766256 46.2680118, 12.378634 46.269248, 12.3795266 46.2696065, 12.3810733 46.270388, 12.3823086 46.2707798, 12.3825721 46.2711388, 12.3828623 46.2713564, 12.385174 46.2721575, 12.3864155 46.2722382, 12.3886575 46.2736224, 12.3893818 46.2742907, 12.3913813 46.2746686, 12.3929621 46.2761648, 12.3930374 46.2764375, 12.3928334 46.2767476, 12.3925868 46.2768993, 12.3916623 46.2769832, 12.391353 46.2771247, 12.3910387 46.2776334, 12.3909113 46.2787234, 12.3918816 46.2792702, 12.3923292 46.2794028, 12.3934716 46.2800445, 12.3941033 46.2802826, 12.3951963 46.2810607, 12.395838 46.2811964, 12.3973512 46.2817292, 12.3976579 46.2819111, 12.3978591 46.2823505, 12.3985654 46.2830586, 12.399954 46.2839856, 12.4011782 46.2845354, 12.4017693 46.2845664, 12.4039021 46.2850695, 12.4045035 46.2853589, 12.4054499 46.2863647, 12.40592 46.2866935, 12.4068925 46.2871745, 12.4073059 46.2869653, 12.4073612 46.2868617, 12.4071635 46.2865075, 12.4071612 46.2862888, 12.4073634 46.2860137, 12.4077541 46.2857514, 12.4081545 46.2855507, 12.408765 46.2854422, 12.4094704 46.2854581, 12.4105943 46.2856934, 12.4125723 46.2862715, 12.4144096 46.2863569, 12.4152478 46.2864982, 12.4170222 46.286582, 12.4188548 46.28623, 12.4195816 46.2865961, 12.4210375 46.2870136, 12.4223611 46.287026, 12.4228614 46.287116, 12.424523 46.2877218, 12.4248172 46.2876322, 12.4248856 46.2875201, 12.4246906 46.287131, 12.4260102 46.2869334, 12.4264126 46.2869599, 12.4269323 46.2871728, 12.4273691 46.28727, 12.4276849 46.2872596, 12.4277945 46.2876118, 12.4280026 46.2877477, 12.4292855 46.2880913, 12.4346206 46.2888931, 12.4358487 46.2896025, 12.436516 46.2904394, 12.4368922 46.291567, 12.4371782 46.2919231, 12.439529 46.2929026, 12.4399215 46.2931387, 12.440054 46.2935438, 12.4399003 46.294677, 12.4392059 46.2976691, 12.4383366 46.2995381, 12.4380284 46.3007378, 12.4380388 46.3015948, 12.4383299 46.3018461, 12.4434136 46.3021174, 12.4436259 46.3018948, 12.4439576 46.3001886, 12.4439297 46.2994828, 12.4428617 46.2971738, 12.4421553 46.2950073, 12.4425796 46.2946885, 12.4444347 46.2948135, 12.4458967 46.2948461, 12.4460508 46.2936955, 12.4464881 46.2929708, 12.4465238 46.2922022, 12.4462149 46.291251, 12.4462132 46.2902019, 12.4455458 46.288823, 12.4456434 46.288353, 12.4465657 46.2869573, 12.4468551 46.2861593, 12.4475703 46.2854234, 12.4493526 46.2839768, 12.4519402 46.2831078, 12.454452 46.2825991, 12.4589118 46.2823361, 12.4617729 46.2811989, 12.4626427 46.2806547, 12.463572 46.2802714, 12.4648696 46.2794783, 12.4652733 46.2789277, 12.4664285 46.2779391, 12.4675713 46.2766704, 12.4682489 46.2761958, 12.4701605 46.2752064, 12.4724133 46.2733198, 12.4728678 46.2728183, 12.4733877 46.27248, 12.4744925 46.2720323, 12.4752771 46.2714201, 12.4765167 46.270783, 12.4773316 46.2706086, 12.4781353 46.2706788, 12.4787806 46.2709029, 12.4794383 46.271407, 12.4802548 46.2722993, 12.481627 46.2731689, 12.4823959 46.2734482, 12.4846196 46.2738993, 12.4863606 46.2744272, 12.4869532 46.2747026, 12.4870917 46.2749853, 12.4874543 46.2753256, 12.4879306 46.2753885, 12.4893621 46.2749653, 12.490475 46.2754444, 12.4915897 46.2761741, 12.4922921 46.2763009, 12.4932431 46.2759507, 12.4939391 46.2761933, 12.4949654 46.2759626, 12.4958946 46.2738321, 12.49626 46.2735603, 12.4969591 46.2737155, 12.4992337 46.2747095, 12.5012094 46.2756271, 12.5016051 46.2758814, 12.501691 46.2763148, 12.5015893 46.2768803, 12.5011489 46.2775653, 12.5014321 46.2780413, 12.5010668 46.2786522, 12.5008172 46.2805368, 12.5010111 46.2809801, 12.501623 46.2809519, 12.5034009 46.2806761, 12.5061065 46.2799657, 12.5064199 46.2797277, 12.5063302 46.279481, 12.5067619 46.2788608, 12.5075919 46.2783544, 12.5074331 46.2774066, 12.5075482 46.2770944, 12.5081813 46.2764787, 12.5099535 46.2767274, 12.5105246 46.2769796, 12.5123721 46.2763776, 12.5133389 46.2761888, 12.5152608 46.2755137, 12.5158869 46.2754458, 12.5164486 46.2757705, 12.5172488 46.2760955, 12.5180493 46.2767245, 12.5185076 46.2769822, 12.5194301 46.2766749, 12.5197979 46.2766892, 12.5205217 46.2773041, 12.5206902 46.277592, 12.5210539 46.2773381, 12.5215453 46.2773087, 12.5223144 46.2773917, 12.5225693 46.277591, 12.5229487 46.2776891, 12.5232541 46.2776876, 12.5238126 46.2775369, 12.5244287 46.2779328, 12.5251399 46.2777765, 12.5259645 46.2779824, 12.5266364 46.2779236, 12.5277605 46.2782407, 12.5287766 46.278747, 12.5297193 46.2789208, 12.530845 46.2795875, 12.5317915 46.2794678, 12.5319307 46.279603, 12.5318846 46.280007, 12.5321676 46.2799805, 12.5333928 46.2795613, 12.535501 46.2802927, 12.5367572 46.2810569, 12.5383031 46.2818281, 12.5387769 46.2822562, 12.5394644 46.2826733, 12.5395361 46.2827622, 12.5392193 46.2833586, 12.5392592 46.2835956, 12.5397281 46.284104, 12.5402117 46.2842893, 12.5417186 46.2844354, 12.5423154 46.2846231, 12.5426458 46.2848488, 12.5439543 46.2852004, 12.5438984 46.2853216, 12.5434481 46.2855218, 12.5433242 46.2857552, 12.5433423 46.2859129, 12.5435956 46.2861719, 12.5440405 46.2863739, 12.5453477 46.2864719, 12.5458943 46.2866585, 12.5467765 46.2872369, 12.547452 46.2867967, 12.5478016 46.2868743, 12.5479322 46.2867721, 12.5479928 46.2865461, 12.5491007 46.2865873, 12.5496008 46.2866855, 12.5503672 46.2870341, 12.5517523 46.2870813, 12.5521493 46.2872297, 12.5533108 46.2872021, 12.5539493 46.2870234, 12.5551129 46.2872319, 12.5556196 46.2871816, 12.556289 46.2874407, 12.5565675 46.2874203, 12.556917 46.287218, 12.5572667 46.2872954, 12.5578086 46.2875868, 12.5582957 46.2876933, 12.559122 46.2875449, 12.5601589 46.2871999, 12.5610743 46.2876041, 12.5619279 46.2882605, 12.5629242 46.2885441, 12.5634035 46.2885455, 12.5635364 46.288391, 12.5635364 46.2878227, 12.5636907 46.2877561, 12.5647413 46.2879532, 12.565046 46.2879073, 12.5658146 46.2873554, 12.5678284 46.2871621, 12.5684523 46.2870268, 12.5688778 46.2868173, 12.5694738 46.2858856, 12.5695544 46.2852054, 12.5694485 46.2838646, 12.5698241 46.2833839, 12.5707256 46.2832456, 12.5716564 46.2833004, 12.573415 46.28374, 12.5753857 46.2839478, 12.5774227 46.2846555, 12.5777014 46.2846265, 12.5784453 46.2843449, 12.579658 46.2837236, 12.5817664 46.2822382, 12.5825577 46.2811621, 12.583007 46.2798338, 12.5829869 46.2791427, 12.5835674 46.2771265, 12.5843878 46.275098, 12.5847704 46.2747127, 12.5853294 46.274331, 12.5864438 46.2736464, 12.5869722 46.2732246, 12.588217 46.272499, 12.5889332 46.2719605, 12.5891327 46.2716961, 12.5891877 46.2715101, 12.5886156 46.2710845, 12.5875707 46.270784, 12.5857587 46.2709957, 12.5847393 46.2707526, 12.5838149 46.2703628, 12.5823457 46.2701363, 12.5819435 46.2701543, 12.5814762 46.2704023, 12.5811337 46.2707376, 12.5806571 46.2708984, 12.5804478 46.2708533, 12.5802545 46.2706619, 12.5802428 46.2704419, 12.5809108 46.2699351, 12.5796398 46.2702745, 12.5783049 46.270466, 12.5777911 46.2703997, 12.577374 46.2700148, 12.5772625 46.2694878, 12.577566 46.2690269, 12.5778218 46.2688468, 12.5786505 46.2682634, 12.5794221 46.2675941, 12.5806274 46.2663386, 12.5812204 46.2655631, 12.5819926 46.2639974, 12.5823519 46.262126, 12.5821242 46.2603062, 12.5821331 46.2593197, 12.5826224 46.2587981, 12.5829756 46.2582007, 12.5837953 46.2556641, 12.5838499 46.2550109, 12.5836027 46.2538278, 12.5845757 46.2542514, 12.5855821 46.2544648, 12.5867312 46.2542328, 12.5879566 46.2543654, 12.5884911 46.2542607, 12.5889624 46.2540579, 12.5906471 46.2541769, 12.590919 46.2541961, 12.5917167 46.2542525, 12.5922241 46.2542092, 12.593725 46.2540813, 12.5949215 46.2541705, 12.5966893 46.2552754, 12.5981748 46.2557976, 12.5990445 46.2556042, 12.6010688 46.2556462, 12.601595 46.2558138, 12.602107 46.2555367, 12.6033513 46.2553482, 12.6035878 46.254949, 12.6028779 46.2524776, 12.602827 46.2507368, 12.6023607 46.2496327, 12.6019166 46.2482058, 12.6014303 46.2460974, 12.6010182 46.2454327, 12.6004628 46.2447883, 12.5997351 46.2442113, 12.5997873 46.24374, 12.601584 46.2428162, 12.6028928 46.2423353, 12.6046105 46.2427911, 12.6067732 46.2430697, 12.6073441 46.2430284, 12.6096235 46.2423099, 12.610191 46.2419235, 12.6104968 46.2415784, 12.610497 46.2401202, 12.6117653 46.2384368, 12.6128929 46.2376606, 12.613751 46.2372463, 12.6153545 46.2368517, 12.6154957 46.2365927, 12.6154587 46.2362515, 12.6150505 46.2357817, 12.6136902 46.2349498, 12.6138198 46.2345234, 12.6141859 46.2338822, 12.6157483 46.2323344, 12.6161114 46.2321778, 12.617994 46.2325036, 12.6194229 46.2320848, 12.6197968 46.2320952, 12.6210489 46.2324381, 12.6214213 46.2324181, 12.6217386 46.2322977, 12.6217125 46.231751, 12.6208731 46.2288346, 12.6202719 46.2279399, 12.6196162 46.2265033, 12.6194402 46.2258627, 12.6200372 46.2240555, 12.6197395 46.2231576, 12.6190568 46.2218706, 12.616844 46.2208499, 12.6161916 46.2202249, 12.6156305 46.2189938, 12.6156512 46.2185172, 12.6153899 46.2185588, 12.6152674 46.2176452, 12.6137549 46.2157242, 12.6127106 46.2155644, 12.6121287 46.2141714, 12.6121805 46.2138106, 12.6124102 46.213415, 12.6118173 46.21323, 12.6115802 46.2129661, 12.6115259 46.2123962, 12.6112623 46.2120626, 12.610883 46.2118441, 12.6096873 46.2117039, 12.6089741 46.2104347, 12.6087569 46.2102391, 12.6087236 46.2099423, 12.6089228 46.2097463, 12.6096948 46.2091439, 12.6109698 46.2084083, 12.6119862 46.2074226, 12.611986 46.206948, 12.6122573 46.2059468, 12.6127414 46.20577, 12.6148852 46.2055414, 12.6159193 46.2055774, 12.6163484 46.2057157, 12.6171364 46.2061781, 12.6183177 46.2065399, 12.619786 46.2067362, 12.6209418 46.2068039, 12.6232023 46.2067503, 12.6244014 46.2064467, 12.6256683 46.2052913, 12.6261737 46.2052247, 12.6264065 46.2052908, 12.6265039 46.2056107, 12.6264424 46.2060652, 12.6269182 46.2061366, 12.6274887 46.2059731, 12.6278152 46.2054653, 12.6280251 46.2049231, 12.6279705 46.2037856, 12.6282387 46.2029121, 12.6284814 46.2025017, 12.6300444 46.2017475, 12.6306904 46.2013513, 12.6315152 46.2011358, 12.6325407 46.2005525, 12.6331442 46.2005272, 12.6339316 46.20004, 12.6349391 46.1997301, 12.6381131 46.1997802, 12.6397196 46.1999033, 12.6410676 46.1997446, 12.6420365 46.1999054, 12.6437348 46.2004915, 12.6444729 46.2011739, 12.6454362 46.2013848, 12.6460202 46.2020272, 12.6476471 46.2023857, 12.649049 46.2031186, 12.6507046 46.2032985, 12.6521394 46.2036396, 12.6547684 46.2046017, 12.6552019 46.2049804, 12.6573399 46.2082892, 12.6584048 46.2103548, 12.6585582 46.2114679, 12.6584541 46.2132888, 12.6580361 46.2156398, 12.6579279 46.2170507, 12.6584684 46.2172481, 12.6595981 46.217892, 12.6610115 46.2191584, 12.6621351 46.2200361, 12.6628477 46.2203152, 12.6634574 46.2202735, 12.6664598 46.2194358, 12.6673038 46.2195681, 12.6683731 46.2202515, 12.6696452 46.2200617, 12.670326 46.2201331, 12.671994 46.2213609, 12.6740677 46.2237764, 12.676069 46.2244787, 12.677147 46.2249609, 12.6780332 46.2255686, 12.6783573 46.2262368, 12.6791702 46.2285834, 12.6797526 46.2290268, 12.6806361 46.2306844, 12.6810772 46.2310385, 12.6819306 46.2314442, 12.6834657 46.2323959, 12.684693 46.2327803, 12.68848 46.2334179, 12.6896049 46.2332824, 12.6924894 46.2331968, 12.6930235 46.2328193, 12.6946375 46.233873, 12.6938411 46.2345761, 12.6932221 46.2354986, 12.6922741 46.2363568, 12.691275 46.2374441, 12.6933788 46.2396728, 12.6935808 46.2402954, 12.694196 46.2414441, 12.694556 46.2427458, 12.6950171 46.2436181, 12.6955788 46.2450534, 12.6961032 46.2458982, 12.6962289 46.2463609, 12.6974209 46.2471042, 12.6983023 46.247841, 12.7004755 46.2509053, 12.6987941 46.2536392, 12.6991829 46.2555394, 12.6990372 46.2565433, 12.6985354 46.2581298, 12.6987354 46.2583064, 12.7001741 46.2571272, 12.701097 46.2568724, 12.7012975 46.2570347, 12.7014185 46.2602416, 12.7017832 46.2607985, 12.7022516 46.2612769, 12.7008777 46.2621179, 12.7003084 46.26284, 12.7003402 46.2630708, 12.7000765 46.263425, 12.6982352 46.2638194, 12.697788 46.2640982, 12.6977952 46.2673921, 12.6990061 46.2681931, 12.7000107 46.2684722, 12.7006927 46.2685291, 12.7012657 46.2687132, 12.703466 46.270656, 12.7037978 46.2711517, 12.7040787 46.2718765, 12.7061912 46.2719476, 12.7066637 46.2720578, 12.7070686 46.2722961, 12.7073175 46.2732935, 12.7092001 46.2743353, 12.7096203 46.2751341, 12.7105181 46.2756302, 12.7106119 46.2758493, 12.7103203 46.2767892, 12.7111983 46.2779054, 12.7115897 46.2787871, 12.7118842 46.2798686, 12.7113356 46.2804074, 12.7105861 46.2809677, 12.7103335 46.2815524, 12.7103102 46.2821128, 12.7105314 46.2827789, 12.711035 46.2836376, 12.712405 46.2846143, 12.7132802 46.2850201, 12.7135051 46.2856, 12.7138759 46.2856649, 12.7144522 46.2852737, 12.71489 46.2852249, 12.7158415 46.2857905, 12.7171906 46.2857743, 12.7185768 46.2868663, 12.7186698 46.2871271, 12.7182711 46.2872341, 12.7180104 46.2875166, 12.7185236 46.2886487, 12.719519 46.289661, 12.7194301 46.2898031, 12.7156495 46.2910719, 12.715132 46.2923781, 12.7150873 46.2929526, 12.7142502 46.2931228, 12.7133978 46.2931634, 12.712873 46.2933111, 12.7127862 46.293899, 12.712106 46.2942882, 12.7119652 46.2951771, 12.7114046 46.2956836, 12.7113243 46.296617, 12.7109773 46.297473, 12.7110406 46.2979489, 12.7120449 46.2987457, 12.7120862 46.29925, 12.7122548 46.2996848, 12.7126645 46.3003115, 12.712771 46.3017375, 12.7133265 46.3023527, 12.7149683 46.3037951, 12.7164138 46.3054637, 12.7176577 46.3064953, 12.7182708 46.3072267, 12.7190521 46.3074005, 12.7196167 46.3078001, 12.720912 46.3090694, 12.7230443 46.3102336, 12.7239319 46.3104327, 12.7239809 46.3107638, 12.723535 46.3119878, 12.7230912 46.312745, 12.7229808 46.3132608, 12.7228724 46.3133797, 12.7204966 46.3135357, 12.7191075 46.3138008, 12.7181195 46.3141414, 12.7155764 46.3153491, 12.7128396 46.3164358, 12.7110137 46.3167901, 12.7092442 46.3176322, 12.7073469 46.3182901, 12.7058107 46.3192339, 12.7055205 46.3195781, 12.7050838 46.3213171, 12.7052406 46.3221531, 12.7061011 46.3228546, 12.7071328 46.3238964, 12.7071319 46.3247392, 12.7062328 46.325284, 12.7051221 46.3261689, 12.703927 46.3275491, 12.7030035 46.3288978, 12.7022132 46.3313271, 12.7012828 46.3319893, 12.6978611 46.3348669, 12.6961275 46.3357788, 12.6952351 46.3364882, 12.6938263 46.3376693, 12.6932043 46.338326, 12.6928232 46.3391573, 12.6926229 46.3403946, 12.6925321 46.3445911, 12.6923504 46.3454786, 12.6916666 46.3464852, 12.6916955 46.3468042, 12.691876 46.3469802, 12.6948088 46.3482023, 12.6958305 46.3491219, 12.6965371 46.3499164, 12.6973832 46.3505405, 12.6979665 46.3511116, 12.7000746 46.351349, 12.7007673 46.3515223, 12.7015491 46.3521577, 12.7021838 46.3536442, 12.7032666 46.3557088, 12.7036014 46.3568558, 12.704274 46.360125, 12.705373 46.3623226, 12.7059423 46.3629078, 12.7075992 46.3641388, 12.7098411 46.3659733, 12.712207 46.3683637, 12.71729 46.3717101, 12.7178532 46.3723677, 12.7177228 46.3728039, 12.7168548 46.3736511, 12.7166546 46.3743421, 12.7160036 46.374685, 12.7163124 46.3749116, 12.7170382 46.3751295, 12.7174868 46.3755283, 12.7171313 46.3764196, 12.7166927 46.3769533, 12.7167037 46.3772756, 12.7164393 46.377745, 12.7157964 46.378478, 12.7152691 46.3787895, 12.7145306 46.3788765, 12.7141714 46.3786828, 12.714295 46.3774817, 12.712287 46.3774755, 12.7121113 46.3775737, 12.7118388 46.3788227, 12.7114022 46.3793055, 12.7118106 46.3806698, 12.711053 46.381214, 12.7091063 46.3814971, 12.7060542 46.3814942, 12.7045298 46.3814053, 12.7034593 46.3812313, 12.7029863 46.3808319, 12.7025107 46.3799069, 12.7024685 46.3791603, 12.7022246 46.3791384, 12.7011739 46.3796597, 12.7008874 46.3794844, 12.7007115 46.3790062, 12.7002718 46.3789805, 12.6998223 46.3797681, 12.6988774 46.3801051, 12.6982931 46.3801027, 12.6977899 46.3798914, 12.697841 46.3796625, 12.6982178 46.3794816, 12.698736 46.3793903, 12.6987286 46.3789834, 12.6983541 46.3785689, 12.6950887 46.3787574, 12.6925523 46.3785029, 12.6918519 46.3782684, 12.6900971 46.3780634, 12.6894566 46.3781522, 12.6871443 46.37897, 12.6857828 46.3791031, 12.6848655 46.3789916, 12.6845063 46.378798, 12.684371 46.378524, 12.6844261 46.3772198, 12.6842897 46.3758101, 12.6839584 46.3751199, 12.6831329 46.3741335, 12.6825369 46.3738252, 12.6823894 46.3738392, 12.682211 46.3745814, 12.6819282 46.3748978, 12.6814281 46.3750687, 12.6806507 46.3751295, 12.6793125 46.3743744, 12.6779655 46.3741325, 12.6765334 46.3744831, 12.6754575 46.3744443, 12.6746161 46.3741318, 12.6740742 46.3735687, 12.6736208 46.3727118, 12.6719613 46.3754581, 12.6715639 46.3755856, 12.6704506 46.3764275, 12.6691681 46.3766775, 12.6683503 46.3767087, 12.6675242 46.377257, 12.6660523 46.3779142, 12.665483 46.3780551, 12.6653635 46.3779849, 12.6649418 46.3769592, 12.6638631 46.3758353, 12.6630658 46.3755818, 12.6623317 46.3755668, 12.6620281 46.3752216, 12.6614969 46.3750411, 12.6597115 46.3749877, 12.6592573 46.3747241, 12.65828 46.3746702, 12.6573099 46.3744469, 12.6566235 46.3738904, 12.6561826 46.373322, 12.6561583 46.3727451, 12.6559403 46.3721134, 12.6538336 46.3712109, 12.6507991 46.3703637, 12.6500899 46.3697728, 12.6478203 46.3695905, 12.6465093 46.3693262, 12.6446061 46.3703041, 12.6440826 46.37109, 12.6439635 46.3715792, 12.644343 46.374134, 12.6441067 46.3745147, 12.643651 46.3748613, 12.640784 46.3757315, 12.6391016 46.3764286, 12.6382726 46.3763437, 12.6376273 46.3759744, 12.635914 46.3753796, 12.6352534 46.375366, 12.6338685 46.3756763, 12.6330855 46.3756601, 12.632404 46.3755612, 12.6313939 46.3751335, 12.6307023 46.3755805, 12.628992 46.3764071, 12.6250256 46.3782021, 12.6240146 46.3785355, 12.6224464 46.378711, 12.6207672 46.3787457, 12.6198152 46.378678, 12.6188308 46.3785001, 12.6177933 46.3780709, 12.6164078 46.3773308, 12.616632 46.3778102, 12.6165555 46.3791657, 12.615312 46.3805626, 12.613331 46.3821825, 12.613162 46.3826875, 12.6132355 46.3832485, 12.6131091 46.3842564, 12.6121517 46.3850735, 12.6091365 46.3868074, 12.6062123 46.3881361, 12.605584 46.3889073, 12.6054315 46.3898619, 12.6049948 46.3907675, 12.6041856 46.3919077, 12.6031094 46.392987, 12.6031346 46.3935299, 12.6029055 46.3937285, 12.6020102 46.3934724, 12.600822 46.3920745, 12.5995544 46.3919293, 12.5983092 46.3912759, 12.597862 46.3914191, 12.598163 46.3934935, 12.5980345 46.3944001, 12.5974803 46.3953559, 12.5967808 46.3962061, 12.596226 46.3963175, 12.5925485 46.3963757, 12.5923548 46.3963208, 12.5923483 46.3959139, 12.5920708 46.3955351, 12.5914234 46.3952163, 12.5902774 46.3954534, 12.5899674 46.3959375, 12.5901847 46.3963038, 12.591337 46.3971808, 12.5922017 46.3981313, 12.5918935 46.3995657, 12.5918755 46.3996181, 12.5915002 46.4007101, 12.5888514 46.3996542, 12.587187 46.3991373, 12.5860395 46.3989676, 12.5852769 46.3991369, 12.5845087 46.3995614, 12.5839962 46.4002975, 12.5839588 46.4011443, 12.5842294 46.4016755, 12.5851949 46.4025604, 12.5852113 46.4027472, 12.5844297 46.4037987, 12.5831572 46.4048274, 12.582365 46.4052715, 12.5817666 46.4052849, 12.5805615 46.4049588, 12.579533 46.4044975, 12.5786092 46.4052011, 12.5778813 46.4055925, 12.5751371 46.4055852, 12.5736586 46.4057742, 12.5722135 46.4061646, 12.5714985 46.4065132, 12.5729584 46.407378, 12.5740155 46.4082228, 12.5750673 46.4093545, 12.5763165 46.4104922, 12.5782977 46.4116868, 12.5779976 46.4123754, 12.5763941 46.4142739, 12.5761723 46.4143031, 12.5708381 46.4130033, 12.5655839 46.4120967, 12.5650162 46.4121815, 12.5645185 46.4120661, 12.5638583 46.412032, 12.5637772 46.4125142, 12.5621557 46.415257, 12.5608967 46.4160291, 12.559227 46.4166512, 12.5583697 46.4168089, 12.5579379 46.4170511, 12.5574096 46.4179044, 12.5568287 46.4193836, 12.5556217 46.4217141, 12.55458 46.4219296, 12.5532811 46.4224519, 12.5508859 46.4240381, 12.5505974 46.4244894, 12.5504431 46.425146, 12.5507476 46.4271019, 12.5506884 46.4284229, 12.5499754 46.4297614, 12.5491326 46.4296727, 12.5486249 46.4296193, 12.5469901 46.4296193, 12.5462053 46.4299043, 12.5446679 46.4302881, 12.542335 46.4313574, 12.5411339 46.4315572, 12.5383478 46.4313616, 12.5363127 46.4314738, 12.5353885 46.431792, 12.5335677 46.4338292, 12.5307033 46.4359257, 12.5282906 46.4382921, 12.5242617 46.4399376, 12.5225094 46.4391301, 12.523317 46.441261, 12.5229378 46.4420267, 12.5220506 46.4426027, 12.5218516 46.4431938, 12.520592 46.4434343, 12.5189357 46.4438746, 12.5174017 46.4444664, 12.5141728 46.4444558, 12.5128829 46.4449204, 12.5123586 46.4442113, 12.5120226 46.4439967, 12.510865 46.4433437, 12.5100983 46.4430706, 12.5092894 46.4426297, 12.5082427 46.442195, 12.5077122 46.4417688, 12.5058964 46.4409343, 12.5056531 46.4407879, 12.505379 46.4404046, 12.5043547 46.4398466, 12.5002242 46.4357935, 12.4993288 46.4346047, 12.4987903 46.4336281, 12.4988166 46.4334184, 12.4996429 46.4324746, 12.4999794 46.4314912, 12.4968982 46.4284661, 12.4956308 46.4270387, 12.4953666 46.4268947, 12.4944709 46.4267195, 12.4938171 46.425173, 12.4931211 46.4241443, 12.4930538 46.4239088, 12.4934293 46.4225311, 12.4953091 46.4172911, 12.4961299 46.4161895, 12.4973689 46.4148198, 12.4991079 46.4126683, 12.4991537 46.4125171))";
                //heightMap = heightMap.ApplyGeometryMask(mask).BakeCoordinates();

                var hmapSRID = dataset.SRID;
                //    .BakeCoordinates();
                ModelGenerationTransform transform = new ModelGenerationTransform(bbox,
                    datasetSrid: hmapSRID,
                    outputSrid: Reprojection.SRID_PROJECTED_MERCATOR,
                    centerOnOrigin: true,
                    zFactor: Z_FACTOR,
                    centerOnZOrigin: true);

                _logger.LogInformation($"Processing height map data ({heightMap.Count} coordinates)...");
                heightMap = transform.TransformHeightMap(heightMap).BakeCoordinates();

                //=======================
                // Textures
                //
                PBRTexture pbrTexture = null;
                if (withTexture)
                {


                    Console.WriteLine("Download image tiles...");
                    var bboxImagery = bbox.ReprojectTo(hmapSRID, 4326);
                    TileRange tiles = _imageryService.ComputeBoundingBoxTileRange(bboxImagery, provider, TEXTURE_TILES);
                    tiles = _imageryService.DownloadTiles(tiles, provider);
                    string fileName = Path.Combine(outputDir, "Texture.jpg");
                    string fileNameMask = Path.Combine(outputDir, "Texture_mask.jpg");

                    var maskCoords = ((NetTopologySuite.Geometries.Polygon)GeometryService.ParseWKTAsGeometry(mask)).ExteriorRing.Coordinates.Select(c=> c.ToGeoPoint());

                    Console.WriteLine("Construct texture...");
                    TextureInfo texInfo = _imageryService.ConstructTexture(tiles, bboxImagery, fileName, TextureImageFormat.image_jpeg);

                    _imageryService.ConstructTextureWithPolygonMask(tiles, bboxImagery, fileNameMask, TextureImageFormat.image_jpeg, maskCoords);
                    //
                    //=======================

                    //=======================
                    // Normal map
                    Console.WriteLine("Height map...");

                    //hMap = hMap.CenterOnOrigin().ZScale(Z_FACTOR);
                    //var normalMap = _imageryService.GenerateNormalMap(heightMap, outputDir);

                    pbrTexture = PBRTexture.Create(texInfo);

                    //
                    //=======================
                }
                // Triangulate height map
                _logger.LogInformation($"Triangulating height map and generating 3D mesh...");

                var model = _sharpGltfService.CreateTerrainMesh(heightMap, pbrTexture, reduceFactor: REDUCTION);
                model.SaveGLB(Path.Combine(Directory.GetCurrentDirectory(), modelName + ".glb"));

                _logger.LogInformation($"Model exported as {Path.Combine(Directory.GetCurrentDirectory(), modelName + ".gltf")} and .glb");

                _logger.LogInformation($"Done in {sw.Elapsed:g}");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, ex.Message);
            }
        }
    }
}
